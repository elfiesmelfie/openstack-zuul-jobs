- job:
    name: openstack-doc-build
    parent: tox-docs
    run: playbooks/tox/docs
    roles:
      - zuul: openstack-infra/openstack-zuul-jobs

- job:
    name: tox-py35-on-zuul
    parent: tox-py35
    description: |
      Run zuul's py35 unittests on patches to zuul-jobs
    vars:
      zuul_work_dir: "src/git.openstack.org/openstack-infra/zuul"
    required-projects:
      - name: openstack-infra/zuul
        override-branch: feature/zuulv3

- job:
    name: tox-py35-constraints
    parent: tox-py35
    description: |
      Run zuul's tox 'py35' job but with OpenStack requirements constraints
    required-projects:
      - name: openstack/requirements
    vars:
      tox_environment:
        UPPER_CONSTRAINTS_FILE: "{{ ansible_user_dir }}/src/git.openstack.org/openstack/requirements/upper-constraints.txt"

- job:
    name: publish-openstack-python-tarball
    parent: publish-openstack-artifacts
    description: |
      Publish the results of the tox-tarball job to tarballs.openstack.org.
    pre-run: playbooks/python-tarball/pre
    run: playbooks/python-tarball/run
    post-run: playbooks/python-tarball/post

- job:
    name: build-openstack-python-tarball
    parent: python-sdist
    description: |
      Build a tarball using tox but do not upload it anywhere.
    pre-run: playbooks/python-tarball/pre
    run: playbooks/python-tarball/run

- job:
    name: announce-release
    description:
      Send a release announcement after publishing a project
    pre-run: playbooks/release/pre
    run: playbooks/release/announce
    required-projects:
      - openstack-infra/release-tools

- project-template:
    name: publish-to-pypi
    pre-release:
      jobs:
        - publish-openstack-python-tarball
        - announce-release:
            dependencies:
              - publish-openstack-python-tarball
        - propose-update-constraints:
            dependencies:
              - publish-openstack-python-tarball
    release:
      jobs:
        - publish-openstack-python-tarball
        - announce-release:
            dependencies:
              - publish-openstack-python-tarball
        - propose-update-constraints:
            dependencies:
              - publish-openstack-python-tarball

- project:
    name: openstack-infra/openstack-zuul-jobs
    check:
      jobs:
        - openstack-doc-build
        - tox-linters
    gate:
      jobs:
        - openstack-doc-build
        - tox-linters
